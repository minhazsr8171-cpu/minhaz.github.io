<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Birthday ‚Äî Butki ‚ù§Ô∏è</title>
  <meta name="description" content="Interactive romantic birthday card: click the toggle to blow the candle, soft music + bird chirps, confetti and balloons." />
  <style>
    /* ---------- Colors & layout ---------- */
    :root{
      --bg1:#fff0f3; --bg2:#ffe6db; --accent:#ff6f91; --muted:rgba(0,0,0,0.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#222}
    .page{min-height:100%;display:flex;align-items:center;justify-content:center;padding:28px}
    .card{width:100%;max-width:920px;border-radius:18px;padding:26px;background:linear-gradient(180deg,rgba(255,255,255,0.85),rgba(255,255,255,0.9));box-shadow:0 18px 40px rgba(12,22,48,0.12);position:relative;overflow:hidden}
    h1{margin:0;font-size:2.1rem;text-align:left}
    p.lead{margin:6px 0 18px;color:#333}

    /* ---------- Decorative bokeh circles ---------- */
    .bokeh{position:absolute;right:-80px;top:-80px;width:360px;height:360px;border-radius:50%;background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.6), rgba(255,255,255,0.12) 30%, transparent 50%);filter:blur(40px);opacity:0.9}
    .bokeh2{position:absolute;left:-60px;bottom:-80px;width:240px;height:240px;border-radius:50%;background:radial-gradient(circle at 30% 30%, rgba(255,230,240,0.6), rgba(255,230,240,0.08) 30%, transparent 50%);filter:blur(30px)}

    /* ---------- Main stage: candle, toggle, message ---------- */
    .stage{display:flex;gap:24px;align-items:center}
    .left{flex:0 0 360px}
    .right{flex:1}

    /* Candle box */
    .candle-wrap{background:linear-gradient(180deg,#fff 0%, #fffefc 100%);border-radius:14px;padding:18px;display:flex;flex-direction:column;align-items:center;box-shadow:0 8px 24px rgba(17,24,39,0.06)}
    .cake{width:220px;height:140px;background:linear-gradient(180deg,#ffd2b8,#ffbfa0);border-radius:14px;position:relative;display:flex;align-items:flex-start;justify-content:center}
    .icing{position:absolute;top:0;left:0;right:0;height:40px;background:linear-gradient(180deg,#fff7f2,#ffe7db);border-radius:12px 12px 0 0;box-shadow:inset 0 -6px 18px rgba(0,0,0,0.04)}

    /* Candle */
    .candle{position:relative;width:22px;height:70px;background:#fff;border-radius:6px;margin-top:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    .wick{position:absolute;top:-8px;left:50%;transform:translateX(-50%);width:2px;height:12px;background:#3b3b3b;border-radius:2px}

    /* SVG flame container */
    .flame-wrap{position:absolute;top:-36px;left:50%;transform:translateX(-50%);width:46px;height:64px;pointer-events:none}
    .flame-svg{filter:drop-shadow(0 6px 18px rgba(255,120,60,0.12))}
    .flame{transform-origin:center top;animation:flicker 900ms infinite}
    @keyframes flicker{0%{transform:translateY(0) scale(1)}50%{transform:translateY(2px) scale(1.05)}100%{transform:translateY(0) scale(1)}}

    /* smoke */
    .smoke{position:absolute;top:-22px;left:50%;transform:translateX(-50%);width:6px;height:6px;border-radius:50%;background:rgba(120,120,120,0.12);opacity:0}

    /* Toggle (styled) */
    .toggle-row{display:flex;align-items:center;gap:12px;margin-top:16px}
    .switch{position:relative;width:68px;height:36px;background:linear-gradient(180deg,#ffecec,#ffd6e0);border-radius:999px;padding:6px;cursor:pointer}
    .knob{position:absolute;top:6px;left:6px;width:24px;height:24px;background:white;border-radius:50%;box-shadow:0 6px 16px rgba(12,20,40,0.12);transition:left 220ms ease}
    .switch.on{background:linear-gradient(90deg,#ff8aa4,#ff5b8b)}
    .switch.on .knob{left:38px}
    .label{font-weight:600;color:#333}

    /* message & name */
    .wish{font-size:1.4rem;font-weight:700;margin-top:8px;color:#2b2b2b}
    .name{font-size:1.9rem;color:var(--accent);letter-spacing:0.6px;text-shadow:0 6px 18px rgba(255,111,145,0.12)}

    /* confetti canvas */
    canvas.confetti{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none}

    /* balloons */
    .balloon{position:absolute;bottom:-120px;width:56px;height:72px;border-radius:50% 50% 52% 52%;background:var(--accent);left:20%;transform:translateX(-50%);animation:rise 6s linear forwards;box-shadow:0 8px 24px rgba(0,0,0,0.12)}
    .balloon:after{content:'';position:absolute;left:50%;bottom:-22px;width:2px;height:28px;background:rgba(0,0,0,0.08);transform:translateX(-50%)}
    @keyframes rise{0%{transform:translateY(0)}100%{transform:translateY(-120vh);opacity:0}}

    /* small controls */
    .controls{display:flex;gap:8px;align-items:center;margin-top:14px}
    .btn{background:#fff;border:1px solid var(--muted);padding:8px 12px;border-radius:10px;cursor:pointer}

    /* overlay to ask user to tap for sound (mobile autoplay rules) */
    .sound-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(255,255,255,0.6),rgba(255,255,255,0.4));backdrop-filter: blur(2px);z-index:20}
    .sound-card{background:white;padding:22px;border-radius:12px;box-shadow:0 12px 40px rgba(12,20,40,0.12);text-align:center;color:#222}
    .sound-card button{margin-top:8px;background:linear-gradient(90deg,#ff8aa4,#ff5b8b);border:none;color:white;padding:10px 18px;border-radius:10px}

    /* responsive */
    @media (max-width:820px){.stage{flex-direction:column}.left{flex-basis:auto}}
  </style>
</head>
<body>
  <div class="page">
    <div class="card" id="card">
      <div class="bokeh"></div>
      <div class="bokeh2"></div>
      <canvas class="confetti" id="confettiCanvas"></canvas>

      <div style="display:flex;justify-content:space-between;align-items:center;gap:16px;">
        <div>
          <h1>Happy Birthday</h1>
          <p class="lead">For <strong class="name">Happy Birthday Butki</strong> ‚Äî my heart, my joy.</p>
        </div>
        <div style="text-align:right;opacity:0.7">Made with ‚ù§Ô∏è by you</div>
      </div>

      <div class="stage" style="margin-top:18px">
        <div class="left">
          <div class="candle-wrap">
            <div class="cake" id="cake">
              <div class="icing"></div>
              <div class="candle" id="candle">
                <div class="wick"></div>
                <div class="flame-wrap" aria-hidden>
                  <!-- flame is SVG for better glow -->
                  <svg class="flame-svg flame" viewBox="0 0 64 96" width="46" height="64" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                      <radialGradient id="g1" cx="30%" cy="20%" r="70%">
                        <stop offset="0%" stop-color="#fff59d" stop-opacity="1"/>
                        <stop offset="40%" stop-color="#ffd54d" stop-opacity="0.95"/>
                        <stop offset="100%" stop-color="#ff7043" stop-opacity="0.9"/>
                      </radialGradient>
                    </defs>
                    <path d="M32 0C32 0 20 12 20 24c0 12 7 22 12 26 5-4 12-14 12-26C56 12 44 0 32 0z" fill="url(#g1)"/>
                    <path d="M32 18c0 0-2 3-2 6s2 8 2 8 2-5 2-8-2-6-2-6z" fill="#ff8a50" opacity="0.95"/>
                  </svg>
                </div>
                <div class="smoke" id="smoke1"></div>
                <div class="smoke" id="smoke2"></div>
              </div>
            </div>

            <div class="toggle-row">
              <div class="switch" id="switch" role="button" aria-pressed="false" tabindex="0">
                <div class="knob"></div>
              </div>
              <div class="label">Blow the candle</div>
            </div>

            <div class="controls">
              <button class="btn" id="resetBtn">Relight</button>
              <button class="btn" id="downloadBtn">Download Snapshot</button>
            </div>
          </div>
        </div>

        <div class="right">
          <div class="wish">Make a wish, then toggle below to blow the candle ‚Äî watch the magic!</div>
          <div id="bigMessage" style="margin-top:20px;font-size:1.6rem;opacity:0;transition:opacity 700ms ease">üéâ <strong>Happy Birthday, Butki!</strong> üéâ</div>
        </div>
      </div>

    </div>
  </div>

  <!-- small overlay to request tap (so audio can start reliably on mobile) -->
  <div class="sound-overlay" id="soundOverlay">
    <div class="sound-card">
      <div style="font-size:1.1rem;font-weight:700">Tap to enable sound</div>
      <div style="margin-top:6px;color:#555">Soft romantic music & gentle birds will play.</div>
      <button id="enableSoundBtn">Tap to Start</button>
    </div>
  </div>

  <script>
    /* ---------- Basic interactions ---------- */
    const switchEl = document.getElementById('switch');
    const knob = switchEl.querySelector('.knob');
    const flameSvg = document.querySelector('.flame');
    const smoke1 = document.getElementById('smoke1');
    const smoke2 = document.getElementById('smoke2');
    const bigMsg = document.getElementById('bigMessage');
    const confettiCanvas = document.getElementById('confettiCanvas');
    const resetBtn = document.getElementById('resetBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    let blown = false;

    function setSwitch(on){
      if(on){
        switchEl.classList.add('on');
        switchEl.setAttribute('aria-pressed','true');
      } else {
        switchEl.classList.remove('on');
        switchEl.setAttribute('aria-pressed','false');
      }
    }

    switchEl.addEventListener('click',()=>{
      if(blown) return; // already blown
      setSwitch(true);
      blowOut();
    });

    switchEl.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' ') { e.preventDefault(); switchEl.click(); } });

    resetBtn.addEventListener('click',resetAll);

    /* ---------- Candle blow animation + visuals ---------- */
    function blowOut(){
      blown = true;
      // fade flame
      flameSvg.style.transition = 'transform 900ms ease, opacity 900ms ease';
      flameSvg.style.opacity = '0';
      flameSvg.style.transform = 'translateY(-6px) scale(0.6)';
      // smoke animation using simple JS
      animateSmoke(smoke1, 0);
      animateSmoke(smoke2, 200);
      // show big message
      setTimeout(()=>{ bigMsg.style.opacity = '1'; }, 1000);
      // launch confetti and balloons
      launchConfetti();
      launchBalloons();
      // play music
      playBirthdayMusic();
    }

    function animateSmoke(elem, delay){
      elem.style.opacity = '1';
      elem.style.transition = 'opacity 1500ms ease';
      setTimeout(()=>{
        elem.style.opacity = '0';
      }, 1500 + delay);
    }

    /* ---------- Confetti and balloons ---------- */
    const ctx = confettiCanvas.getContext('2d');
    let confettiPieces = [];

    function randomRange(min,max){
      return Math.random()*(max-min)+min;
    }

    function launchConfetti(){
      confettiPieces = [];
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
      for(let i=0;i<120;i++){
        confettiPieces.push({
          x:randomRange(0,confettiCanvas.width),
          y:randomRange(-confettiCanvas.height,0),
          r:randomRange(4,10),
          d:randomRange(10,20),
          color: `hsl(${randomRange(300,360)}, 70%, 70%)`,
          tilt:randomRange(-10,10),
          tiltAngle:0,
          tiltAngleIncrement:randomRange(0.05,0.12)
        });
      }
      requestAnimationFrame(updateConfetti);
    }

    function updateConfetti(){
      ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
      confettiPieces.forEach(p=>{
        p.tiltAngle += p.tiltAngleIncrement;
        p.y += (Math.cos(p.d)+3)/2 + 1;
        p.x += Math.sin(p.tiltAngle);
        p.tilt = Math.sin(p.tiltAngle)*15;
        ctx.beginPath();
        ctx.lineWidth = p.r/2;
        ctx.strokeStyle = p.color;
        ctx.moveTo(p.x + p.tilt + p.r/2, p.y);
        ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r/2);
        ctx.stroke();
      });
      confettiPieces = confettiPieces.filter(p=>p.y < confettiCanvas.height+20);
      if(confettiPieces.length > 0) requestAnimationFrame(updateConfetti);
    }

    /* ---------- Balloons ---------- */
    function launchBalloons(){
      const colors = ['#ff6f91','#ff92a5','#ffb3bc','#ffc6ca','#ffe0e6'];
      for(let i=0;i<8;i++){
        const balloon = document.createElement('div');
        balloon.className = 'balloon';
        balloon.style.left = (10 + i*12) + '%';
        balloon.style.background = colors[i % colors.length];
        balloon.style.animationDuration = (5 + i*0.3) + 's';
        balloon.style.animationDelay = (i*250) + 'ms';
        document.body.appendChild(balloon);
        setTimeout(()=>{
          balloon.remove();
        }, 7000);
      }
    }

    /* ---------- Music ---------- */
    let audioCtx, gainNode, oscillatorNodes;

    function playBirthdayMusic(){
      if(!audioCtx){
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        gainNode = audioCtx.createGain();
        gainNode.gain.setValueAtTime(0.06, audioCtx.currentTime); // volume (soft)
        gainNode.connect(audioCtx.destination);
      }

      // simple synthesized "Happy Birthday" melody (notes freq & durations)
      const notes = [
        [264,400],[264,400],[297,800],[264,800],[352,800],[330,1600],
        [264,400],[264,400],[297,800],[264,800],[396,800],[352,1600],
        [264,400],[264,400],[528,800],[440,800],[352,800],[330,800],[297,1600],
        [466,400],[466,400],[440,800],[352,800],[396,800],[352,1600]
      ];

      let time = audioCtx.currentTime;
      oscillatorNodes = [];

      notes.forEach(([freq,duration],i)=>{
        const osc = audioCtx.createOscillator();
        osc.frequency.setValueAtTime(freq, time);
        osc.type = 'sine';
        osc.connect(gainNode);
        osc.start(time);
        osc.stop(time + duration/1000);
        oscillatorNodes.push(osc);
        time += duration/1000;
      });
    }

    /* ---------- Reset ---------- */
    function resetAll(){
      blown = false;
      setSwitch(false);
      bigMsg.style.opacity = '0';
      flameSvg.style.opacity = '1';
      flameSvg.style.transform = 'translateY(0) scale(1)';
      smoke1.style.opacity = '0';
      smoke2.style.opacity = '0';
      confettiPieces = [];
      ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
    }

    resetBtn.addEventListener('click', resetAll);

    /* ---------- Download snapshot ---------- */
    downloadBtn.addEventListener('click', ()=>{
      html2canvas(document.querySelector('.card')).then(canvas => {
        const a = document.createElement('a');
        a.href = canvas.toDataURL('image/png');
        a.download = 'happy_birthday_butki.png';
        a.click();
      });
    });

    /* ---------- Sound overlay ---------- */
    const soundOverlay = document.getElementById('soundOverlay');
    const enableSoundBtn = document.getElementById('enableSoundBtn');
    enableSoundBtn.addEventListener('click', ()=>{
      if(!audioCtx){
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      audioCtx.resume().then(() => {
        soundOverlay.style.display = 'none';
      });
    });

    /* ---------- Load html2canvas for screenshot ---------- */
    // dynamically load html2canvas
    (function(){
      let script = document.createElement('script');
      script.src = "https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js";
      script.onload = () => { console.log('html2canvas loaded') };
      document.head.appendChild(script);
    })();

    /* ---------- Resize canvas on window resize ---------- */
    window.addEventListener('resize', ()=>{
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    });

  </script>
</body>
</html>
